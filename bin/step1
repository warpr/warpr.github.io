#!/bin/bash

SOURCE="${BASH_SOURCE[0]}"
while [ -h "$SOURCE" ] ; do SOURCE="$(readlink "$SOURCE")"; done
DIR="$( cd -P "$( dirname "$SOURCE" )" && pwd )"

CURL="curl --silent"
JSONINDENT="/home/warp/dotrc/bin/jsonindent"

mkdir -p "$DIR/../activity"
cd "$DIR/../activity"

echo "Github events"
$CURL --header 'Accept: application/json' 'https://api.github.com/users/warpr/events' > github.events.json
echo "Bitbucket events"
$CURL 'https://bitbucket.org/warp/profile/activity' > bitbucket.events.html
echo "Twitter events"
$CURL 'https://mobile.twitter.com/byld' > twitter.events.html
echo "warpr.org events"
$CURL 'https://warpr.org/atom/' > warpr.org.atom.xml
echo "frob.nl blog events"
$CURL 'https://frob.nl/blog/atom/' > blog.atom.xml
echo "identi.ca events"
$CURL 'https://identi.ca/warp/' | grep initialData | sed 's/.*initialData = //' | sed 's/;$//' | $JSONINDENT > identi.ca.json
echo "stackoverflow events"
$CURL 'http://stackoverflow.com/feeds/user/7700' > stackoverflow.atom.xml
echo "steam recent games"
# FIXME: this doesn't include the avatar.
$CURL 'http://steamcommunity.com/id/paksangsoo/games/' | grep rgGames | sed 's/.*rgGames = //' | sed 's/\;\r//' | jsonindent > steamgames.json
echo "done"

